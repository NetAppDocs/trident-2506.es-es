---
sidebar: sidebar 
permalink: trident-use/ontap-san-examples.html 
keywords: map backends, storage classes, trident backend, ontap san, ontap san economy, options, storageclasses, fsx, metrocluster, ad, active directory 
summary: Aprenda cómo crear y utilizar controladores ONTAP SAN con su instalación de Trident .  Esta sección proporciona ejemplos de configuración de backend y detalles sobre cómo asignar backends a StorageClasses. 
---
= Opciones y ejemplos de configuración de SAN de ONTAP
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Aprenda cómo crear y utilizar controladores ONTAP SAN con su instalación de Trident .  Esta sección proporciona ejemplos de configuración de backend y detalles para mapear backends a StorageClasses.

link:https://docs.netapp.com/us-en/asa-r2/get-started/learn-about.html["Sistemas ASA r2"^]Se diferencia de otros sistemas ONTAP (ASA, AFF y FAS) en la implementación de su capa de almacenamiento.  Estas variaciones afectan al uso de ciertos parámetros, tal como se indica. link:https://docs.netapp.com/us-en/asa-r2/learn-more/hardware-comparison.html["Obtenga más información sobre las diferencias entre los sistemas ASA r2 y otros sistemas ONTAP ."^].


NOTE: Sólo el `ontap-san` El controlador (con protocolos iSCSI y NVMe/TCP) es compatible con los sistemas ASA r2.

En la configuración del backend de Trident , no es necesario especificar que su sistema sea ASA r2.  Cuando seleccionas `ontap-san` como el `storageDriverName` Trident detecta automáticamente el ASA r2 o el sistema ONTAP tradicional.  Algunos parámetros de configuración del backend no son aplicables a los sistemas ASA r2, como se indica en la tabla siguiente.



== Opciones de configuración del backend

Consulte la siguiente tabla para ver las opciones de configuración del backend:

[cols="1,3,2"]
|===
| Parámetro | Descripción | Por defecto 


| `version` |  | Siempre 1 


| `storageDriverName` | Nombre del controlador de almacenamiento | `ontap-san`o `ontap-san-economy` 


| `backendName` | Nombre personalizado o el backend de almacenamiento | Nombre del controlador + "_" + dataLIF 


| `managementLIF`  a| 
Dirección IP de un clúster o LIF de gestión de SVM.

Se puede especificar un nombre de dominio completo (FQDN).

Se puede configurar para usar direcciones IPv6 si Trident se instaló usando la bandera IPv6.  Las direcciones IPv6 deben definirse entre corchetes, como por ejemplo: `[28e8:d9fb:a825:b7bf:69a8:d02f:9e7b:3555]` .

Para una transición fluida a MetroCluster , consulte<<mcc-best>> .


NOTE: Si está utilizando credenciales "vsadmin", `managementLIF` debe ser la del SVM; si se utilizan credenciales de "administrador", `managementLIF` debe ser el del grupo.
| "10.0.0.1", "[2001:1234:abcd::fefe]" 


| `dataLIF` | Dirección IP del protocolo LIF.  Se puede configurar para usar direcciones IPv6 si Trident se instaló usando la bandera IPv6.  Las direcciones IPv6 deben definirse entre corchetes, como por ejemplo: `[28e8:d9fb:a825:b7bf:69a8:d02f:9e7b:3555]` .  *No especificar para iSCSI.*  Trident utilizalink:https://docs.netapp.com/us-en/ontap/san-admin/selective-lun-map-concept.html["Mapa selectivo de LUN de ONTAP"^] para descubrir los LIF iSCSI necesarios para establecer una sesión de múltiples rutas.  Se genera una advertencia si `dataLIF` está definido explícitamente.  *Omitir para Metrocluster.* Ver el<<mcc-best>> . | Derivado por la SVM 


| `svm` | Máquina virtual de almacenamiento a utilizar *Omitir para Metrocluster.* Ver el<<mcc-best>> . | Derivado si se trata de una SVM `managementLIF` se especifica 


| `useCHAP` | Utilice CHAP para autenticar iSCSI para controladores SAN ONTAP [Booleano].  Empezar a `true` para que Trident configure y utilice CHAP bidireccional como autenticación predeterminada para el SVM proporcionado en el backend. Referirse a link:ontap-san-prep.html["Prepárese para configurar el backend con los controladores SAN de ONTAP."] Para más detalles.  *No compatible con FCP ni NVMe/TCP.* | `false` 


| `chapInitiatorSecret` | Secreto del iniciador de CHAP.  Requerido si `useCHAP=true` | "" 


| `labels` | Conjunto de etiquetas arbitrarias con formato JSON para aplicar a los volúmenes | "" 


| `chapTargetInitiatorSecret` | Secreto del iniciador del objetivo CHAP.  Requerido si `useCHAP=true` | "" 


| `chapUsername` | Nombre de usuario entrante.  Requerido si `useCHAP=true` | "" 


| `chapTargetUsername` | Nombre de usuario objetivo.  Requerido si `useCHAP=true` | "" 


| `clientCertificate` | Valor codificado en Base64 del certificado del cliente.  Se utiliza para la autenticación basada en certificados. | "" 


| `clientPrivateKey` | Valor codificado en Base64 de la clave privada del cliente.  Se utiliza para la autenticación basada en certificados. | "" 


| `trustedCACertificate` | Valor codificado en Base64 del certificado de CA de confianza. Opcional.  Se utiliza para la autenticación basada en certificados. | "" 


| `username` | Nombre de usuario necesario para comunicarse con el clúster ONTAP . Se utiliza para la autenticación basada en credenciales. Para la autenticación de Active Directory, consulte link:../trident-use/ontap-san-examples.html#authenticate-trident-to-a-backend-svm-using-active-directory-credentials["Autenticar Trident en un SVM backend mediante credenciales de Active Directory"]. | "" 


| `password` | Contraseña necesaria para comunicarse con el clúster ONTAP . Se utiliza para la autenticación basada en credenciales. Para la autenticación de Active Directory, consulte link:../trident-use/ontap-san-examples.html#authenticate-trident-to-a-backend-svm-using-active-directory-credentials["Autenticar Trident en un SVM backend mediante credenciales de Active Directory"]. | "" 


| `svm` | máquina virtual de almacenamiento a utilizar | Derivado si se trata de una SVM `managementLIF` se especifica 


| `storagePrefix` | Prefijo utilizado al aprovisionar nuevos volúmenes en la SVM.  No se puede modificar posteriormente.  Para actualizar este parámetro, deberá crear un nuevo backend. | `trident` 


| `aggregate`  a| 
Agregado para aprovisionamiento (opcional; si se establece, debe asignarse a la SVM).  Para el `ontap-nas-flexgroup` conductor, esta opción se ignora.  Si no se asigna, cualquiera de los agregados disponibles se puede utilizar para aprovisionar un volumen FlexGroup .


NOTE: Cuando se actualiza el agregado en SVM, se actualiza automáticamente en Trident mediante sondeos a SVM sin necesidad de reiniciar el controlador Trident .  Cuando se ha configurado un agregado específico en Trident para aprovisionar volúmenes, si el agregado se renombra o se mueve fuera del SVM, el backend pasará a un estado de error en Trident mientras consulta el agregado del SVM.  Debe cambiar el agregado por uno que esté presente en la SVM o eliminarlo por completo para volver a poner en línea el backend.

*No especificar para sistemas ASA r2*.
 a| 
""



| `limitAggregateUsage` | Fallará el aprovisionamiento si el uso supera este porcentaje.  Si utiliza un backend de Amazon FSx for NetApp ONTAP , no especifique `limitAggregateUsage` .  El proporcionado `fsxadmin` y `vsadmin` No contienen los permisos necesarios para recuperar el uso agregado y limitarlo mediante Trident.  *No especificar para sistemas ASA r2*. | " (no se aplica por defecto) 


| `limitVolumeSize` | Fallará el aprovisionamiento si el tamaño de volumen solicitado supera este valor. También restringe el tamaño máximo de los volúmenes que administra para las LUN. | " (no se aplica por defecto) 


| `lunsPerFlexvol` | Número máximo de LUN por Flexvol, debe estar en el rango [50, 200] | `100` 


| `debugTraceFlags` | Indicadores de depuración para usar al solucionar problemas.  Ejemplo: {"api":false, "method":true} No lo utilice a menos que esté solucionando problemas y necesite un volcado de registro detallado. | `null` 


| `useREST`  a| 
Parámetro booleano para utilizar las API REST de ONTAP .

 `useREST`Cuando se configura para `true` Trident utiliza las API REST de ONTAP para comunicarse con el backend; cuando se configura en `false` Trident utiliza llamadas ONTAPI (ZAPI) para comunicarse con el backend. Esta función requiere ONTAP 9.11.1 y versiones posteriores.  Además, el rol de inicio de sesión de ONTAP utilizado debe tener acceso a `ontapi` solicitud.  Esto se satisface mediante lo predefinido. `vsadmin` y `cluster-admin` roles.  A partir de la versión Trident 24.06 y ONTAP 9.15.1 o posterior, `useREST` está configurado para `true` por defecto; cambiar `useREST` a `false` para utilizar llamadas ONTAPI (ZAPI).

`useREST`está totalmente cualificado para NVMe/TCP.


NOTE: NVMe solo es compatible con las API REST de ONTAP y no con ONTAPI (ZAPI).

*Si se especifica, siempre se establecerá en `true` para sistemas ASA r2*.
| `true`para ONTAP 9.15.1 o posterior, de lo contrario `false` . 


 a| 
`sanType`
| Utilice para seleccionar `iscsi` para iSCSI, `nvme` para NVMe/TCP o `fcp` para SCSI sobre Fibre Channel (FC). | `iscsi`si está en blanco 


| `formatOptions`  a| 
Usar `formatOptions` para especificar los argumentos de la línea de comandos para el `mkfs` comando que se aplicará siempre que se formatee un volumen.  Esto le permite formatear el volumen según sus preferencias.  Asegúrese de especificar las opciones de formato de forma similar a las opciones del comando mkfs, excluyendo la ruta del dispositivo.  Ejemplo: "-E no descartar"

*Compatible con `ontap-san` y `ontap-san-economy` controladores con protocolo iSCSI.*  *Además, se admite para sistemas ASA r2 cuando se utilizan los protocolos iSCSI y NVMe/TCP.*
 a| 



| `limitVolumePoolSize` | Tamaño máximo de FlexVol solicitable al usar LUN en el backend ontap-san-economy. | " (no se aplica por defecto) 


| `denyNewVolumePools` | Restringe `ontap-san-economy` Los sistemas backend crean nuevos volúmenes FlexVol para contener sus LUN.  Solo se utilizan Flexvols preexistentes para el aprovisionamiento de nuevos PV. |  
|===


=== Recomendaciones para el uso de formatOptions

Trident recomienda la siguiente opción para agilizar el proceso de formateo:

*-E no descartar:*

* Conservar, no intentar descartar bloques en el momento de mkfs (descartar bloques inicialmente es útil en dispositivos de estado sólido y almacenamiento disperso/de aprovisionamiento ligero).  Esto reemplaza la opción obsoleta "-K" y es aplicable a todos los sistemas de archivos (xfs, ext3 y ext4).




=== Autenticar Trident en un SVM backend mediante credenciales de Active Directory

Puede configurar Trident para autenticarse en un SVM de backend usando credenciales de Active Directory (AD). Antes de que una cuenta de AD pueda acceder a la SVM, debe configurar el acceso del controlador de dominio de AD al clúster o SVM. Para la administración de un clúster con una cuenta de AD, debe crear un túnel de dominio. Referirse a link:https://docs.netapp.com/us-en/ontap/authentication/enable-ad-users-groups-access-cluster-svm-task.html["Configurar el acceso al controlador de dominio de Active Directory en ONTAP"^] Para más detalles.

.pasos
. Configurar los ajustes del Sistema de nombres de dominio (DNS) para un SVM de backend:
+
`vserver services dns create -vserver <svm_name> -dns-servers <dns_server_ip1>,<dns_server_ip2>`

. Ejecute el siguiente comando para crear una cuenta de computadora para la SVM en Active Directory:
+
`vserver active-directory create -vserver DataSVM -account-name ADSERVER1 -domain demo.netapp.com`

. Utilice este comando para crear un usuario o grupo de AD para administrar el clúster o SVM
+
`security login create -vserver <svm_name> -user-or-group-name <ad_user_or_group> -application <application> -authentication-method domain -role vsadmin`

. En el archivo de configuración del backend de Trident , configure el `username` y `password` parámetros al nombre de usuario o grupo de AD y la contraseña, respectivamente.




== Opciones de configuración de backend para el aprovisionamiento de volúmenes

Puedes controlar el aprovisionamiento predeterminado utilizando estas opciones en el `defaults` sección de la configuración.  Para ver un ejemplo, consulte los ejemplos de configuración a continuación.

[cols="1,3,2"]
|===
| Parámetro | Descripción | Por defecto 


| `spaceAllocation` | Asignación de espacio para LUN | "verdadero" *Si se especifica, establecer en `true` para sistemas ASA r2*. 


| `spaceReserve` | Modo de reserva de espacio: "ninguno" (delgado) o "volumen" (grueso).  *Empezar a `none` para sistemas ASA r2*. | "ninguno" 


| `snapshotPolicy` | Política de instantáneas a utilizar.  *Empezar a `none` para sistemas ASA r2*. | "ninguno" 


| `qosPolicy` | Grupo de políticas QoS que se asignará a los volúmenes creados.  Elija una de las opciones qosPolicy o adaptiveQosPolicy por grupo de almacenamiento/backend.  El uso de grupos de políticas QoS con Trident requiere ONTAP 9.8 o posterior.  Debe utilizar un grupo de políticas QoS no compartido y asegurarse de que el grupo de políticas se aplique a cada componente individualmente.  Un grupo de políticas QoS compartidas impone un límite máximo al rendimiento total de todas las cargas de trabajo. | "" 


| `adaptiveQosPolicy` | Grupo de políticas QoS adaptativas para asignar a los volúmenes creados.  Elija una de las opciones qosPolicy o adaptiveQosPolicy por grupo de almacenamiento/backend. | "" 


| `snapshotReserve` | Porcentaje de volumen reservado para instantáneas.  *No especificar para sistemas ASA r2*. | "0" si `snapshotPolicy` es "ninguno", de lo contrario "" 


| `splitOnClone` | Separar un clon de su progenitor al crearlo | "FALSO" 


| `encryption` | Habilite el cifrado de volumen de NetApp (NVE) en el nuevo volumen; el valor predeterminado es `false` .  Para utilizar esta opción, NVE debe estar licenciado y habilitado en el clúster.  Si NAE está habilitado en el backend, cualquier volumen aprovisionado en Trident tendrá NAE habilitado.  Para obtener más información, consulte:link:../trident-reco/security-reco.html["Cómo funciona Trident con NVE y NAE"] . | "falso" *Si se especifica, establecer en `true` para sistemas ASA r2*. 


| `luksEncryption` | Habilitar el cifrado LUKS. Referirse alink:../trident-reco/security-luks.html["Utilice la configuración de clave unificada de Linux (LUKS)."] . | " *Configurado a `false` para sistemas ASA r2*. 


| `tieringPolicy` | Política de jerarquización para usar "ninguna" *No especificar para sistemas ASA r2* . |  


| `nameTemplate` | Plantilla para crear nombres de volumen personalizados. | "" 
|===


=== Ejemplos de aprovisionamiento por volumen

Aquí tenéis un ejemplo con valores predeterminados definidos:

[source, yaml]
----
---
version: 1
storageDriverName: ontap-san
managementLIF: 10.0.0.1
svm: trident_svm
username: admin
password: <password>
labels:
  k8scluster: dev2
  backend: dev2-sanbackend
storagePrefix: alternate-trident
debugTraceFlags:
  api: false
  method: true
defaults:
  spaceReserve: volume
  qosPolicy: standard
  spaceAllocation: 'false'
  snapshotPolicy: default
  snapshotReserve: '10'

----

NOTE: Para todos los volúmenes creados utilizando el `ontap-san` El controlador Trident agrega un 10 por ciento de capacidad adicional al FlexVol para dar cabida a los metadatos de LUN.  La LUN se aprovisionará con el tamaño exacto que el usuario solicite en el PVC.  Trident añade un 10 por ciento al FlexVol (se muestra como Tamaño disponible en ONTAP).  Los usuarios ahora obtendrán la cantidad de capacidad utilizable que solicitaron.  Este cambio también evita que las LUN se conviertan en de solo lectura a menos que se utilice todo el espacio disponible.  Esto no se aplica a ontap-san-economy.

Para backends que definen `snapshotReserve` Trident calcula el tamaño de los volúmenes de la siguiente manera:

[listing]
----
Total volume size = [(PVC requested size) / (1 - (snapshotReserve percentage) / 100)] * 1.1
----
El 1.1 es el 10 por ciento adicional que Trident agrega al FlexVol para acomodar los metadatos del LUN. Para `snapshotReserve` = 5%, y solicitud de PVC = 5 GiB, el tamaño total del volumen es 5,79 GiB y el tamaño disponible es 5,5 GiB.  El `volume show` El comando debería mostrar resultados similares a este ejemplo:

image::../media/vol-show-san.png[Muestra el resultado del comando "show volume."]

Actualmente, la única forma de utilizar el nuevo cálculo para un volumen existente es redimensionándolo.



== Ejemplos de configuración mínima

Los siguientes ejemplos muestran configuraciones básicas que dejan la mayoría de los parámetros con sus valores predeterminados.  Esta es la forma más sencilla de definir un backend.


NOTE: Si utiliza Amazon FSx en NetApp ONTAP con Trident, NetApp recomienda que especifique nombres DNS para las LIF en lugar de direcciones IP.

.Ejemplo de SAN de ONTAP
[%collapsible]
====
Esta es una configuración básica que utiliza `ontap-san` conductor.

[source, yaml]
----
---
version: 1
storageDriverName: ontap-san
managementLIF: 10.0.0.1
svm: svm_iscsi
labels:
  k8scluster: test-cluster-1
  backend: testcluster1-sanbackend
username: vsadmin
password: <password>
----
====
.Ejemplo de MetroCluster
[#mcc-best%collapsible]
====
Puede configurar el backend para evitar tener que actualizar manualmente la definición del backend después del cambio de estado y el cambio de estado durantelink:../trident-reco/backup.html#svm-replication-and-recovery["replicación y recuperación de SVM"] .

Para una conmutación y recuperación sin interrupciones, especifique el SVM utilizando `managementLIF` y omitir el `svm` parámetros. Por ejemplo:

[source, yaml]
----
version: 1
storageDriverName: ontap-san
managementLIF: 192.168.1.66
username: vsadmin
password: password
----
====
.Ejemplo económico de ONTAP SAN
[%collapsible]
====
[source, yaml]
----
version: 1
storageDriverName: ontap-san-economy
managementLIF: 10.0.0.1
svm: svm_iscsi_eco
username: vsadmin
password: <password>
----
====
.Ejemplo de autenticación basada en certificados
[%collapsible]
====
En este ejemplo de configuración básica `clientCertificate` , `clientPrivateKey` , y `trustedCACertificate` (opcional, si se utiliza una CA de confianza) se rellenan en `backend.json` y tome los valores codificados en base64 del certificado del cliente, la clave privada y el certificado de CA de confianza, respectivamente.

[source, yaml]
----
---
version: 1
storageDriverName: ontap-san
backendName: DefaultSANBackend
managementLIF: 10.0.0.1
svm: svm_iscsi
useCHAP: true
chapInitiatorSecret: cl9qxIm36DKyawxy
chapTargetInitiatorSecret: rqxigXgkesIpwxyz
chapTargetUsername: iJF4heBRT0TCwxyz
chapUsername: uh2aNCLSd6cNwxyz
clientCertificate: ZXR0ZXJwYXB...ICMgJ3BhcGVyc2
clientPrivateKey: vciwKIyAgZG...0cnksIGRlc2NyaX
trustedCACertificate: zcyBbaG...b3Igb3duIGNsYXNz
----
====
.Ejemplos de CHAP bidireccionales
[%collapsible]
====
Estos ejemplos crean un backend con `useCHAP` empezar a `true` .

.Ejemplo de ONTAP SAN CHAP
[source, yaml]
----
---
version: 1
storageDriverName: ontap-san
managementLIF: 10.0.0.1
svm: svm_iscsi
labels:
  k8scluster: test-cluster-1
  backend: testcluster1-sanbackend
useCHAP: true
chapInitiatorSecret: cl9qxIm36DKyawxy
chapTargetInitiatorSecret: rqxigXgkesIpwxyz
chapTargetUsername: iJF4heBRT0TCwxyz
chapUsername: uh2aNCLSd6cNwxyz
username: vsadmin
password: <password>
----
.Ejemplo de economía ONTAP SAN CHAP
[source, yaml]
----
---
version: 1
storageDriverName: ontap-san-economy
managementLIF: 10.0.0.1
svm: svm_iscsi_eco
useCHAP: true
chapInitiatorSecret: cl9qxIm36DKyawxy
chapTargetInitiatorSecret: rqxigXgkesIpwxyz
chapTargetUsername: iJF4heBRT0TCwxyz
chapUsername: uh2aNCLSd6cNwxyz
username: vsadmin
password: <password>
----
====
.Ejemplo de NVMe/TCP
[%collapsible]
====
Debe tener una SVM configurada con NVMe en su backend ONTAP .  Esta es una configuración básica de backend para NVMe/TCP.

[source, yaml]
----
---
version: 1
backendName: NVMeBackend
storageDriverName: ontap-san
managementLIF: 10.0.0.1
svm: svm_nvme
username: vsadmin
password: password
sanType: nvme
useREST: true
----
====
.Ejemplo de SCSI sobre FC (FCP)
[%collapsible]
====
Debe tener un SVM configurado con FC en su backend ONTAP .  Esta es una configuración básica de backend para FC.

[source, yaml]
----
---
version: 1
backendName: fcp-backend
storageDriverName: ontap-san
managementLIF: 10.0.0.1
svm: svm_fc
username: vsadmin
password: password
sanType: fcp
useREST: true
----
====
.Ejemplo de configuración de backend con plantilla de nombre
[%collapsible]
====
[source, yaml]
----
---
version: 1
storageDriverName: ontap-san
backendName: ontap-san-backend
managementLIF: <ip address>
svm: svm0
username: <admin>
password: <password>
defaults:
  nameTemplate: "{{.volume.Name}}_{{.labels.cluster}}_{{.volume.Namespace}}_{{.vo\
    lume.RequestName}}"
labels:
  cluster: ClusterA
  PVC: "{{.volume.Namespace}}_{{.volume.RequestName}}"
----
====
.Ejemplo de opciones de formato para el controlador ontap-san-economy
[%collapsible]
====
[source, yaml]
----
---
version: 1
storageDriverName: ontap-san-economy
managementLIF: ""
svm: svm1
username: ""
password: "!"
storagePrefix: whelk_
debugTraceFlags:
  method: true
  api: true
defaults:
  formatOptions: -E nodiscard
----
====


== Ejemplos de backends con pools virtuales

En estos archivos de definición de backend de ejemplo, se establecen valores predeterminados específicos para todos los grupos de almacenamiento, tales como: `spaceReserve` en ninguno, `spaceAllocation` en falso, y `encryption` en falso.  Los grupos virtuales se definen en la sección de almacenamiento.

Trident establece las etiquetas de aprovisionamiento en el campo "Comentarios".  Los comentarios se configuran en el FlexVol volume. Trident copia todas las etiquetas presentes en un grupo virtual al volumen de almacenamiento durante el aprovisionamiento.  Para mayor comodidad, los administradores de almacenamiento pueden definir etiquetas por grupo virtual y agrupar volúmenes por etiqueta.

En estos ejemplos, algunos de los grupos de almacenamiento establecen sus propias configuraciones. `spaceReserve` , `spaceAllocation` , y `encryption` valores, y algunos pools anulan los valores predeterminados.

.Ejemplo de SAN de ONTAP
[%collapsible]
====
[source, yaml]
----
---
version: 1
storageDriverName: ontap-san
managementLIF: 10.0.0.1
svm: svm_iscsi
useCHAP: true
chapInitiatorSecret: cl9qxIm36DKyawxy
chapTargetInitiatorSecret: rqxigXgkesIpwxyz
chapTargetUsername: iJF4heBRT0TCwxyz
chapUsername: uh2aNCLSd6cNwxyz
username: vsadmin
password: <password>
defaults:
  spaceAllocation: "false"
  encryption: "false"
  qosPolicy: standard
labels:
  store: san_store
  kubernetes-cluster: prod-cluster-1
region: us_east_1
storage:
  - labels:
      protection: gold
      creditpoints: "40000"
    zone: us_east_1a
    defaults:
      spaceAllocation: "true"
      encryption: "true"
      adaptiveQosPolicy: adaptive-extreme
  - labels:
      protection: silver
      creditpoints: "20000"
    zone: us_east_1b
    defaults:
      spaceAllocation: "false"
      encryption: "true"
      qosPolicy: premium
  - labels:
      protection: bronze
      creditpoints: "5000"
    zone: us_east_1c
    defaults:
      spaceAllocation: "true"
      encryption: "false"

----
====
.Ejemplo económico de ONTAP SAN
[%collapsible]
====
[source, yaml]
----
---
version: 1
storageDriverName: ontap-san-economy
managementLIF: 10.0.0.1
svm: svm_iscsi_eco
useCHAP: true
chapInitiatorSecret: cl9qxIm36DKyawxy
chapTargetInitiatorSecret: rqxigXgkesIpwxyz
chapTargetUsername: iJF4heBRT0TCwxyz
chapUsername: uh2aNCLSd6cNwxyz
username: vsadmin
password: <password>
defaults:
  spaceAllocation: "false"
  encryption: "false"
labels:
  store: san_economy_store
region: us_east_1
storage:
  - labels:
      app: oracledb
      cost: "30"
    zone: us_east_1a
    defaults:
      spaceAllocation: "true"
      encryption: "true"
  - labels:
      app: postgresdb
      cost: "20"
    zone: us_east_1b
    defaults:
      spaceAllocation: "false"
      encryption: "true"
  - labels:
      app: mysqldb
      cost: "10"
    zone: us_east_1c
    defaults:
      spaceAllocation: "true"
      encryption: "false"
  - labels:
      department: legal
      creditpoints: "5000"
    zone: us_east_1c
    defaults:
      spaceAllocation: "true"
      encryption: "false"

----
====
.Ejemplo de NVMe/TCP
[%collapsible]
====
[source, yaml]
----
---
version: 1
storageDriverName: ontap-san
sanType: nvme
managementLIF: 10.0.0.1
svm: nvme_svm
username: vsadmin
password: <password>
useREST: true
defaults:
  spaceAllocation: "false"
  encryption: "true"
storage:
  - labels:
      app: testApp
      cost: "20"
    defaults:
      spaceAllocation: "false"
      encryption: "false"

----
====


== Asignar backends a StorageClasses

Las siguientes definiciones de StorageClass hacen referencia a<<Ejemplos de backends con pools virtuales>> .  Utilizando el `parameters.selector` En cada campo, cada StorageClass especifica qué grupos virtuales se pueden usar para alojar un volumen.  El volumen tendrá los aspectos definidos en el pool virtual elegido.

* El `protection-gold` StorageClass se asignará al primer grupo virtual en el `ontap-san` backend.  Esta es la única piscina que ofrece protección de nivel oro.
+
[source, yaml]
----
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: protection-gold
provisioner: csi.trident.netapp.io
parameters:
  selector: "protection=gold"
  fsType: "ext4"
----
* El `protection-not-gold` StorageClass se asignará al segundo y tercer grupo virtual en `ontap-san` backend.  Estas son las únicas piscinas que ofrecen un nivel de protección distinto al oro.
+
[source, yaml]
----
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: protection-not-gold
provisioner: csi.trident.netapp.io
parameters:
  selector: "protection!=gold"
  fsType: "ext4"
----
* El `app-mysqldb` StorageClass se asignará al tercer grupo virtual en `ontap-san-economy` backend.  Este es el único pool que ofrece configuración de pool de almacenamiento para aplicaciones de tipo mysqldb.
+
[source, yaml]
----
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: app-mysqldb
provisioner: csi.trident.netapp.io
parameters:
  selector: "app=mysqldb"
  fsType: "ext4"
----
* El `protection-silver-creditpoints-20k` StorageClass se asignará al segundo grupo virtual en `ontap-san` backend.  Este es el único fondo que ofrece protección de nivel plata y 20000 puntos de crédito.
+
[source, yaml]
----
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: protection-silver-creditpoints-20k
provisioner: csi.trident.netapp.io
parameters:
  selector: "protection=silver; creditpoints=20000"
  fsType: "ext4"
----
* El `creditpoints-5k` StorageClass se asignará al tercer grupo virtual en `ontap-san` backend y el cuarto grupo virtual en el `ontap-san-economy` backend.  Estas son las únicas ofertas de pool con 5000 puntos de crédito.
+
[source, yaml]
----
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: creditpoints-5k
provisioner: csi.trident.netapp.io
parameters:
  selector: "creditpoints=5000"
  fsType: "ext4"
----
* El `my-test-app-sc` StorageClass se asignará a `testAPP` piscina virtual en la `ontap-san` conductor con `sanType: nvme` .  Esta es la única oferta de piscina `testApp` .
+
[source, yaml]
----
---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: my-test-app-sc
provisioner: csi.trident.netapp.io
parameters:
  selector: "app=testApp"
  fsType: "ext4"
----


Trident decidirá qué grupo virtual se selecciona y garantiza que se cumplan los requisitos de almacenamiento.
